var hashLoc,hashSet=function(a){if(a||a.p){hashLoc=a.p;var b=!0;switch(a.p){case "client":"info"==a.d&&(hashLoc+="_"+a.id);break;case "zayav":"info"==a.d?hashLoc+="_"+a.id:"add"==a.d?hashLoc+="_add"+(REGEXP_NUMERIC.test(a.id)?"_"+a.id:""):a.d||(b=!1);break;default:a.d&&(hashLoc+="_"+a.d,a.d1&&(hashLoc+="_"+a.d1))}b&&VK.callMethod("setLocation",hashLoc)}},obFilter=function(a){return{op:"ob_spisok",find:$("#find")._search("val"),find_query:a?1:0,country_id:$("#countries").val(),city_id:$("#cities").val(),
rubric_id:$("#rub").val(),rubric_sub_id:$("#rubsub").val(),withfoto:$("#withfoto").val(),nokupez:$("#nokupez").length?$("#nokupez").val():0}},obSpisok=function(a,b){$(".region").hasClass("_busy")||($(".region").addClass("_busy"),$.post(AJAX_MAIN,obFilter("find"==b),function(a){$(".region").removeClass("_busy");a.success&&($(".result").html(a.result),$(".left").html(a.spisok),145<VK_SCROLL&&VK.callMethod("scrollWindow",42))},"json"))},obPreview=function(){if($("#ob-create").length){var a=0,b="",c=
$("._image-spisok ._iview");c.length&&(a=c.eq(0).attr("val"),b=c.eq(0).find("img").attr("src"));var c=$("#txt").val().replace(/\n/g,"<br />"),d=1*$("#rubric_id").val(),f=1*$("#rubric_sub_id").val(),a='<div class="ob-unit"><table class="utab"><tr><td class="txt">'+(a?'<img src="'+b+'" class="_iview" val="'+a+'" />':"")+(d?'<span class="rub">'+RUBRIC_ASS[d]+"</span><u>»</u>":"")+(f?'<span class="rubsub">'+RUBRIC_SUB_ASS[f]+"</span><u>»</u>":"")+c+($("#telefon").val()?'<div class="tel">'+$("#telefon").val()+
"</div>":"")+'<tr><td class="adres" colspan="2">'+(0<$("#country_id").val()?$("#country_id")._select("title"):"")+(0<$("#city_id").val()?", "+$("#city_id")._select("title"):"")+(1==$("#viewer_id_show").val()?VIEWER_LINK:"")+"</table></div>";$("#preview").html(a)}},obMySpisok=function(a,b){$(".result").hasClass("_busy")||(OBMY[b]=a,$(".result").addClass("_busy"),$.post(AJAX_MAIN,OBMY,function(a){$(".result").removeClass("_busy");a.success&&($(".result").html(a.result),$(".left").html(a.spisok))},"json"))},
cityGet=function(a,b,c){if(0!=$("#country_id").val()){a||(a="");if(void 0==b||"0"==b)b=0;$("#city_id")._select("process");VK.api("places.getCities",{country:$("#country_id").val(),q:a},function(d){for(var f=1,h=0;h<d.response.length;h++){var g=d.response[h];g.uid=g.cid;g.content=g.title+(g.area?"<span>"+g.area+"</span>":"");b==g.uid&&(f=0)}b&&f&&d.response.unshift({uid:b,title:c});0==a.length&&(d.response[0].content="<B>"+d.response[0].title+"</B>");$("#city_id")._select(d.response);b&&$("#city_id")._select(b)})}},
cityShow=function(){0==$("#country_id").val()?$("#city_id")._select("remove"):$("#city_id_select").length||($("#city_id")._select({width:180,block:1,title0:"Город не указан",spisok:[],write:1,func:obPreview,funcKeyup:cityGet}),$("#city_id_select").vkHint({width:180,msg:'<div style="text-align:justify">Обязательно указывайте город, если Ваше объявление ориентировано только на него, иначе объявление будет отображаться только в общем списке.</div>',ugol:"left",top:-12,left:211,indent:15}))},_post=function(a){function b(){$("#_post").remove();
_backfon(!1)}a=$.extend({viewer_id:0,photo:"",name:"",dtime:"Дата и время",cont:"Содержание",sa_gazeta_id:0,sa_viewer_id:0,sa_name:""},a);var c='<div id="_post"><div class="head"><table><tr>'+(a.viewer_id?'<td class="im"><a href="//vk.com/id'+a.viewer_id+'" target="_blank">'+a.photo+"</a>":"")+'<td><a class="close">Закрыть</a>'+(a.viewer_id?'<a class="uname" href="//vk.com/id'+a.viewer_id+'" target="_blank">'+a.name+"</a>":"")+'<div class="dtime">'+a.dtime+"</div></table></div>"+(a.sa?'<div class="psa">'+
(a.sa_gazeta_id?"КупецЪ":"")+(a.sa_viewer_id?'<a href="'+URL+"&p=admin&id="+a.sa_viewer_id+'">'+a.sa_name+"</a>":"")+'<div class="ed"><a class="to-arch" val="'+a.id+'">в архив</a><div class="img_edit ob-edit" val="'+a.id+'"></div></div></div>':"")+'<div class="pcont"><div class="rub">'+a.rub+'</div><div class="txt">'+a.txt+"</div>"+(a.images?'<div class="images">'+a.images+"</div>":"")+(a.tel?'<div class="tel">'+a.tel+"</div>":"")+(a.city?'<div class="city">'+a.city+"</div>":"")+'<div class="meter">Просмотры: '+
a.view+'</div></div><div class="foot"><div class="msg">'+(a.msg?a.msg:"")+'</div><input type="text" id="inp" placeholder="Отправить сообщение автору объявления.." /><table class="dn"><tr><td class="photo"><a href="http://vk.com/id'+VIEWER_ID+'" target="_blank">'+U.photo+'</a><td><textarea></textarea><tr><td class="photo"><td class="send"><div class="vkButton"><button>Отправить</button></div><input type="hidden" id="anon" /><input type="hidden" id="only_author" /></table></div></div>';$("#_post").length&&
b();var d=$("body").append(c).find("#_post"),f=d.find("textarea");_backfon(d);a.images?c=10:(c=540-d.height(),c=Math.round(0>c?10:c/2));d.css("top",$(this).scrollTop()+(60<VK_SCROLL?VK_SCROLL-60:0)+c);d.find(".close,.ob-edit").click(b);d.find(".to-arch").click(function(){var a=$(this),c=a.attr("val"),d={op:"ob_archive",id:c};a.hide();$.post(AJAX_MAIN,d,function(d){d.success?(b(),$("#ob"+c).remove()):a.fadeIn(700)},"json")});d.find("#inp").focus(function(){$(this).addClass("dn");d.find(".foot table").removeClass("dn");
f.focus().autosize();$("#anon")._check({name:"Анонимно",func:function(a){d.find(".photo")[(a?"add":"remove")+"Class"]("dn");f.width(a?496:436).focus()}});$("#only_author")._check({name:"Только для получателя"});$("#only_author_check").vkHint({msg:"Если галочка установлена,<br />то сообщение будет видно<br />только автору объявления.",top:-103,left:108});d.find(".foot .vkButton").click(function(){var c=$(this),b={op:"ob_post_msg",id:a.id,txt:$.trim(f.val()),anon:$("#anon").val(),only_author:$("#only_author").val()};
b.txt&&!c.hasClass("_busy")&&(c.addClass("_busy"),$.post(AJAX_MAIN,b,function(a){c.removeClass("_busy");a.success&&(f.val(""),d.find(".msg").append(a.msg))},"json"))})})};
$(document).on("click","a.rub",function(a){a.stopPropagation();$("#rub").rightLink($(this).attr("val"));$("#rubsub").val(0);obSpisok()}).on("click","a.rubsub",function(a){a.stopPropagation();a=$(this).attr("val").split("_");$("#rub").rightLink(a[0]);$("#rubsub").val(a[1]);obSpisok()}).on("click",".ob_next",function(){var a=$(this),b=obFilter();b.page=a.attr("val");a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_MAIN,b,function(c){c.success?a.after(c.spisok).remove():a.removeClass("busy")},"json"))}).on("click",
"#ob_my_next",function(){var a=$(this);a.hasClass("busy")||(OBMY.page=a.attr("val"),a.addClass("busy"),$.post(AJAX_MAIN,OBMY,function(b){b.success?a.after(b.spisok).remove():a.removeClass("busy")},"json"))}).on("click",".ob-unit.show",function(){var a=$(this),b=a.find(".full");b.length?(b.next().removeClass("dn"),b.remove()):(a={op:"ob_post",id:a.attr("id").split("ob")[1]},_wait(),$.post(AJAX_MAIN,a,function(a){_wait(!1);a.success&&_post(a.o)},"json"))}).on("click",".ob-edit",function(a){function b(a,
c){$("#rubric_sub_id").val("number"==typeof c?c:0);RUBRIC_SUB_SPISOK[a]?$("#rubric_sub_id")._select({width:200,title0:"Подрубрика не указана",spisok:RUBRIC_SUB_SPISOK[a]}):$("#rubric_sub_id")._select("remove")}a.stopPropagation();var c=$(this).attr("val"),d=_dialog({top:20,width:550,head:"Редактирование объявления",load:1,butSubmit:"Сохранить",submit:function(){var a={op:"ob_edit",my:$(".ob-spisok").length?0:1,id:c,rubric_id:$("#rubric_id").val(),rubric_sub_id:$("#rubric_sub_id").val(),txt:$.trim($("#txt").val()),
telefon:$("#telefon").val(),country_id:$("#country_id").val(),country_name:$("#country_id")._select("title"),city_id:$("#city_id").val(),city_name:$("#city_id")._select("title")||"",viewer_id_show:$("#viewer_id_show").val(),active:$("#active").val()};a.txt?(d.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#ob"+c).after(a.html).remove(),d.close(),_msg("Объявление изменено")):d.abort()},"json")):(d.bottom.vkHint({msg:'<span class="red">Введите текст объявления</span>',top:-48,left:177,indent:50,
show:1,remove:1}),$("#txt").focus())}});$.post(AJAX_MAIN,{op:"ob_load",id:c},function(a){a.success?(d.content.html('<table class="ob-edit-tab"><tr><td class="label">Рубрика:<td><input type="hidden" id="rubric_id" value="'+a.rubric_id+'" /><input type="hidden" id="rubric_sub_id" value="'+a.rubric_sub_id+'" /><tr><td class="label topi">Текст:<td><textarea id="txt">'+a.txt+'</textarea><tr><td class="label">Контактные телефоны:<td><input type="text" id="telefon" maxlength="200" value="'+a.telefon+'" /><tr><td><td>'+
a.images+'<tr><td class="label topi">Регион:<td><input type="hidden" id="country_id" value="'+a.country_id+'" /><input type="hidden" id="city_id" value="'+a.city_id+'" />'+(a.viewer_id_add?'<tr><td class="label">Показывать имя из VK:<td>':"")+'<input type="hidden" id="viewer_id_show" value="'+a.viewer_id_show+'" /><tr><td class="label topi">Активность:<td><input type="hidden" id="active" value="'+a.active+'" /></table>'),$("#rubric_id")._select({width:130,spisok:RUBRIC_SPISOK,func:b}),b(a.rubric_id,
a.rubric_sub_id),$("#txt").autosize(),imageSortable(),cityShow(),cityGet("",a.city_id,a.city_name),$("#country_id")._select({width:180,title0:"Страна не указана",spisok:COUNTRY_SPISOK,func:function(a){cityShow();a&&($("#city_id")._select(0)._select("process"),VK.api("places.getCities",{country:a},function(a){a=a.response;for(n=0;n<a.length;n++)a[n].uid=a[n].cid;a[0].content="<b>"+a[0].title+"</b>";$("#city_id")._select(a)}))}}),a.viewer_id_add&&$("#viewer_id_show")._check(),$("#active")._radio({spisok:[{uid:1,
title:"Объявление видно всем"},{uid:0,title:"В архиве"}],light:1})):d.loadError()},"json")}).on("mouseenter",".ob-unit.edited",function(){$(this).removeClass("edited")}).on("click",".ob-unit .img_del",function(a){a.stopPropagation();var b=$(this).attr("val"),c=_dialog({top:90,width:260,head:"Удаление объявления",content:"<center>После удаления<br />объявление восстановить<br />будет невозможно.<br /><br /><b>Подтвердите удаление.</b></center>",butSubmit:"Удалить",submit:function(){var a={op:"ob_del",
id:b};c.process();$.post(AJAX_MAIN,a,function(a){a.success?(c.close(),_msg("Объявление удалено"),$("#ob"+b).remove()):c.abort()},"json")}})});
$(document).ready(function(){if($(".ob-spisok").length){$("#find")._search({width:300,focus:1,enter:1,txt:"Быстрый поиск объявлений",func:obSpisok});$(".vkButton").click(function(){document.location.href=URL+"&p=ob&d=create"});$("#countries")._select({width:140,title0:"Страна не выбрана",spisok:COUNTRIES,func:function(a){$("#cities")._select(0);$("#cities")._select(CITIES[a]);$(".city-sel")[(a?"remove":"add")+"Class"]("dn");obSpisok()}});var a=$("#countries").val();$("#cities")._select({width:140,
title0:"Город не выбран",spisok:a?CITIES[a]:[],func:obSpisok});$("#cities_select").vkHint({width:145,msg:"Показываются города,<br />для которых есть<br />активные объявления.",ugol:"right",top:-16,left:-178});$("#rub").rightLink(function(){$("#rubsub").val(0);obSpisok()});$("#withfoto")._check(obSpisok);$("#nokupez")._check(obSpisok);var b=0;window._onScroll.push(function(a){clearTimeout(b);148>a?$("#filter").css("top","0px"):b=setTimeout(function(){$("#filter").animate({top:(148>=a?0:a-148)+"px"},
500)},2E3)})}$("#ob-create").length&&($("._info a").click(function(){_dialog({top:20,width:500,head:"Правила размещения объявлений",content:'<div id="ob-create-rules"><div class="headName">Рекомендации при создании объявления:</div><ul><li>более подробно описывайте свой товар;<li>по возможности прилагайте фотографии, таким образом пользователям будет визуально удобней определять то, что Вы предлагаете; Приложение позволяет загрузить до <u>8-и изображений</u> на одно объявление;<li>обязательно указывайте реальную цену;<li>не подавайте одно и то же объявление повторно, для этого есть специальные недорогие платные сервисы. Повторные объявления будут удаляться;<li>не пишите объявление в ВЕРХНЕМ РЕГИСТРЕ;<li>указывайте номер контактного телефона в соответствующем поле;<li>если Ваше оъявление уже не актуально, удалите его или перенесите в архив в разделе "Мои объявления".</ul><div class=headName>Товары, реклама которых не допускается:</div><ul><li>товаров, производство и (или) реализация которых запрещены законодательством Российской Федерации;<li>наркотических средств, прихотропных веществ и прекурсоров;<li>взрывчатых веществ и материалов, за исключением пиротехнических изделий;<li>органов и (или) тканей человека в качестве объектов купли-продажи;<li>товаров, подлежащих государственной регистрации, в случае отсутствия такой регистрации;<li>товаров, подлежащих обязательной сертификации или иному обязательному подтверждению соответствия требованиям технических регламентов, в случае отсутствия такой сертификации или подтверждения такого соответствия;<li>товары, на производство и (или) реализацию которых требуется получение лицензий или иных специальных разрешений, в случае отсутствия таких разрешений.</ul></div>',
butSubmit:"",butCancel:"Закрыть"})}),$("#rubric_id")._select({width:130,title0:"Не указана",spisok:RUBRIC_SPISOK,func:function(a){$("#rubric_sub_id").val(0);RUBRIC_SUB_SPISOK[a]?$("#rubric_sub_id")._select({width:200,title0:"Подрубрика не указана",spisok:RUBRIC_SUB_SPISOK[a],func:obPreview}):$("#rubric_sub_id")._select("remove");obPreview()}}),$("#txt").autosize().focus().keyup(obPreview),$("#telefon").keyup(obPreview),COUNTRY_ASS[$("#country_id").val()]||$("#country_id").val(0),cityShow(),cityGet("",
CITY_ID,CITY_NAME),$("#country_id")._select({width:180,title0:"Страна не указана",spisok:COUNTRY_SPISOK,func:function(a){cityShow();a&&($("#city_id")._select(0)._select("process"),VK.api("places.getCities",{country:a},function(a){a=a.response;for(n=0;n<a.length;n++)a[n].uid=a[n].cid;a[0].content="<b>"+a[0].title+"</b>";$("#city_id")._select(a)}));obPreview()}}),$("#viewer_id_show")._check(obPreview),$("#pay_service")._check(function(a){$(".pay")[(a?"remove":"add")+"Class"]("dn");$("#dop")._radio(0)}),
$("#dop").html(obPreview),$(".vkCancel").click(function(){location.href=URL+"&p=ob"+$(this).attr("val")}),$(".vkButton").click(function(){function a(b){g.vkHint({msg:'<span class="red">'+b+"</span>",top:-57,left:17,indent:50,show:1,remove:1})}function b(a){VK.api("account.getAppPermissions",{},function(b){"number"==typeof b.response?(k=b.response&4,l=b.response&8192,k&&l?a(0):(VK.callMethod("showSettingsBox",8196),VK.addCallback("onWindowFocus",function(){VK.removeCallback("onWindowFocus");a(13)}),
VK.addCallback("onSettingsChanged",function(b){VK.removeCallback("onWindowFocus");k=b&4;l=b&8192;k&&l?a(12):a(14)}))):a(15)})}function f(){$.post(AJAX_MAIN,e,function(a){a.success?a.server?VK.api("photos.save",{v:5.21,album_id:e.album_id,group_id:e.group_id,server:a.server,photos_list:a.photos_list,hash:a.hash,caption:m},function(b){var c="";b.response&&(b=b.response[0],c="photo"+b.owner_id+"_"+b.id);h(a.insert_id,c)}):h(a.insert_id,""):g.removeClass("busy")},"json")}function h(a,b){var c=URL+"&p=ob&insert_id="+
a;l?VK.api("wall.post",{message:m,attachments:b},function(a){a.response?_msg("Объявление размещено на стене Вашей страницы.",function(){location.href=c+"&wallpost=1"}):location.href=c}):location.href=c}var g=$(this),k=0,l=0,e={op:"ob_create",rubric_id:$("#rubric_id").val(),rubric_sub_id:$("#rubric_sub_id").val(),txt:$.trim($("#txt").val()),telefon:$("#telefon").val(),country_id:$("#country_id").val(),country_name:$("#country_id")._select("title"),city_id:$("#city_id").val(),city_name:$("#city_id")._select("title"),
viewer_id_show:$("#viewer_id_show").val(),dop:$("#dop").val(),upload_url:"",group_id:72078602,album_id:195528889,rule:0},m=$("#rubric_id")._select("title")+(0<e.rubric_sub_id?" » "+$("#rubric_sub_id")._select("title"):"")+":\n"+(150<e.txt.length?e.txt.slice(0,150)+"..":e.txt)+(e.telefon?"\n&#128222; "+e.telefon:"")+"\nЧитайте полностью на vk.com/kupezz";0==e.rubric_id?a("Не выбрана рубрика"):e.txt?g.hasClass("busy")||(g.addClass("busy"),b(function(a){e.rule=a;k?VK.api("photos.getUploadServer",{v:5.21,
group_id:e.group_id,album_id:e.album_id},function(a){a.response&&(e.upload_url=a.response.upload_url);f()}):f()})):(a("Введите текст объявления"),$("#txt").focus())}));$("#ob-my").length&&$("#status").rightLink(obMySpisok)});
